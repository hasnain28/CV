---
name: List repo

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]


jobs:
  list-repo:
    runs-on: ubuntu-latest
    steps:
    - name: check out repo
      uses: actions/checkout@v2

    - name: Generate Vars
      id: generate_vars
      run: |
        # Just Tag
        IMAGE_TAG=sha-$(echo $(git rev-parse --short HEAD) | cut -c1-7)
        # Just Image name
        IMAGE_NAME=${{ github.repository }}
        #Image ID= Name + Tag
        IMAGE_ID=$IMAGE_NAME:$IMAGE_TAG
        IMAGE=$(echo $IMAGE_ID | tr '[:upper:]' '[:lower:]')
        echo "Image: $IMAGE"
        echo "::set-output name=image::$IMAGE"
        echo "::set-output name=image_name::$IMAGE_ID"
        echo "::set-output name=image_tag::$IMAGE_TAG"
        echo ""

    - name: Build Docker Image
      run: |
        docker build -t ${{ steps.generate_vars.outputs.image }}  .
        


    